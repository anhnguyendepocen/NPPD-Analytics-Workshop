---
title: "Introduction to R"
output: 
    revealjs::revealjs_presentation:
        transition: fade
        theme: white
        highlight: zenburn
        css: ../css/slides.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = T, error = T,
                      tidy.opts = list(width.cutoff = 50))
```

# Setting up R for Data Analysis

## Your Background

What do you know already?

> - Excel
> - SAS, SPSS, Minitab
> - Any other programming language
> - SQL or other database

## Installing R

For Windows or OS X:

- Go to http://www.r-project.org/
- Click the CRAN link on the left, and pick a download site (0-Cloud is a good choice)
- Choose link based on your OS
- On Windows, choose the "base" subdirectory to install R.
- On OS X, choose the .pkg file to install R.

## Installing RStudio

- Browse to https://www.rstudio.com/
- Mouse over Products and click RStudio
- Choose RStudio Desktop
- Click Download RStudio Desktop
- Choose the installer appropriate for your platform

# Example: Tips Data

## Goals

- Explore a real dataset using R
- Get the "flavor" of R for data management and exploration
- Don't focus on the code - it will be explained later and in much more detail

## Tips Dataset

A server recorded the tips they received over about 10 weeks, including several variables:

  - Amount they were tipped
  - Cost of the total bill
  - Characteristics about the party (# people, gender, etc.)

## Primary Question:

How do these variable influence the amount being tipped?

Follow along using [Tips-Example.R](code/Tips-Example.R)

## First Look at Data in R

Load the tips data using `read.csv()`

```{r, echo = T}
tips <- read.csv("https://srvanderplas.github.io/NPPD-Analytics-Workshop/01.Introduction/data/tips.csv")
# Short link:
tips <- read.csv("https://bit.ly/2fQoMP1")
```

The `head()` function shows the first few rows of the data: 
```{r, echo = T}
head(tips)
```

## Data Set Attributes

How big is the dataset? What types of variables are in each column?
```{r}
str(tips)
```

## Summary of Variables

R can easily summarize each variable in the dataset: 
```{r}
summary(tips)
```

## Plotting the data

First, we need to install and load `ggplot2`, a library for plotting the data
```{r, eval=FALSE}
install.packages("ggplot2")
library(ggplot2)
```

```{r, echo=FALSE}
library(ggplot2)
```

## Scatterplots

What is the relationship between total bill and tip value? 

```{r, fig.height=3, fig.width=7}
qplot(tip, total_bill, geom = "point", data = tips)
```

## Fancy Scatterplots

Color the points by meal. Is there a difference?

```{r, fig.height=4, fig.width=7}
qplot(tip, total_bill, geom = "point", data = tips, colour = time)
```

## Even More Scatterplots

Add a linear regression line to the plot

```{r, fig.height=4, fig.width=7}
qplot(tip, total_bill, geom = "point", data = tips) + 
    geom_smooth(method = "lm")
```


## Rate of Tipping

Tips are usually based on a percentage of the total bill. 

Make a new variable for the tipping rate = tip / total bill

```{r}
# New variable rate is a combination of 
# other variables in the tips dataset
tips$rate <- tips$tip / tips$total_bill

summary(tips$rate)
```

## Tipping Rate Histogram

What is the distribution of tipping rates? 

```{r, fig.height=4, fig.width=7}
qplot(rate, data = tips, binwidth = .01)
```

## Someone is an AMAZING tipper...

One person tipped over 70%, who are they?

```{r}
tips[which.max(tips$rate),]
```


## Rates by Gender

Look at the average tipping rate for men and women seperately

```{r}
mean(tips$rate[tips$sex == "Male"])
mean(tips$rate[tips$sex == "Female"])
```

## Statistical Significance

There is a difference but is it statistically significant?

```{r}
t.test(rate ~ sex, data = tips)
```

## Boxplots

Boxplots are useful for comparing the distribution of data. Do smokers tip at different rates than non-smokers?

```{r, fig.height=3, fig.width=7}
qplot(smoker, rate, geom = "boxplot", data = tips)
```

## Your Turn {data-background=#527a7a}

Try playing with chunks of code from this session to further investigate the tips data:

1. Get a summary of the total bill values
2. Make side by side boxplots of tip rates for different days of the week
3. Find the average tip value for smokers

## Solutions
### Summary  of Total Bill Values
```{r}
summary(tips$total_bill)
```

## Solutions
### Tip Values by Day of the Week

```{r, fig.height=3, fig.width=7}
qplot(day, rate, geom = "boxplot", data = tips)
```

## Solutions
### Average Tip Value for Smokers
```{r}
mean(tips$tip[tips$smoker == "Yes"])
```



# R Basics

## Getting Help in R
The `help()` function is useful for getting help with a function:

```{r, eval = F}
help(head)
```

The `?` function also works:

```{r, eval = F}
?head
```

When searching for results online, it is helpful to use R + CRAN + <query> to get good results.

## R Reference Card

A copy of the R reference card is available at: 

http://cran.r-project.org/doc/contrib/Short-refcard.pdf

This card contains short versions of the most common functions used in R.

## R as an Overgrown Calculator

R can perform simple mathematical operations.
```{r}
# Addition and Subtraction
2 + 5 - 1

# Multiplication
109*23452

# Division
3/7
```

## R as an Overgrown Calculator

Here are a few more complex operations:
```{r}
# Integer division
7 %/% 2

# Modulo operator (Remainder)
7 %% 2

# Powers
1.5 ^ 3
```

## R as an Overgrown Calculator

```{r}
# Exponentiation
exp(3)

# Logarithms
log(3)
log(3, base = 10)
```

## R as an Overgrown Calculator

```{r}
# Trig functions
sin(0)
cos(0)
tan(pi/4)
```

## Variables in R

Variables in R are created using the assignment operator, `<-`:

```{r}
x <- 5
R_awesomeness <- Inf
MyAge <- 21 #Haha
```

These variables can then be used in computation:
```{r}
log(x)
MyAge ^ 2
```

## Rules for Variable Names

- Can't start with a number
- Names are case-sensitive
- Common letters are used internally by R and should be avoided as variable names    
`c, q, t, C, D, F, T, I`
- There are reserved words that R won't let you use for variable names.    
`for, in, while, if, else, repeat, break, next`
- R will let you use the name of a predefined function.    
Try not to overwrite those!

## Rules for Variable Names
Error messages:
```{r, error = T, collapse = F}
# Variable starts with a number
1age <- 3
```

## Rules for Variable Names
Error messages:
```{r, error = T, collapse = F}
# Case Sensitive
Age <- 3
age
```

## Rules for Variable Names
Error messages:
```{r, error = T, collapse = F}
# Special Words can't be variable names
for <- 3
```

## Rules for Variable Names

```{r, collapse = T}
# This is a VERY bad idea:

T <- FALSE
F <- TRUE

T == FALSE
F == TRUE

rm(T, F) # Fix it!

T == FALSE
```
Note: In R, `T` and `F` are shorthand for `TRUE` and `FALSE` respectively. 

## Vectors
A variable can contain more than one value.    
A _vector_ is a variable which contains a set of values of the same type.    
The `c()` (combine) function is used to create vectors:

```{r}
y <- c(1, 5, 3, 2)
z <- c(y, y)
```

R performs operations on the entire vector at once:
```{r}
y / 2
z + 3
```


## Your Turn {data-background=#527a7a}

Using the R Reference Card (and the Help pages, if needed), do the following:

1. Find out how many rows and columns the `iris' data set has.  Figure out at least 2 ways to do this.    
*Hint: "Variable Information" section on the first page of the reference card!*
2. Use the `rep` function to construct the following vector:  `1 1 2 2 3 3 4 4 5 5`    
*Hint: "Data Creation" section of the reference card*
3. Use `rep` to construct this vector: `1 2 3 4 5 1 2 3 4 5 1 2 3 4 5`

## Your Turn Solutions{data-background=#527a7a}
### Rows and Columns in the `iris` dataset {data-background=#527a7a}

```{r}
data(iris)

# first way: 
nrow(iris)
ncol(iris)
```

## Your Turn Solutions{data-background=#527a7a}
### Rows and Columns in the `iris` dataset {data-background=#527a7a}

```{r}
# second way: 
dim(iris)

# third way: 
str(iris) # look at the top line
```

## Solutions{data-background=#527a7a}
### Use `rep` {data-background=#527a7a}

```{r}
# Use the `rep` function to construct the following vector:  
# 1 1 2 2 3 3 4 4 5 5
rep(c(1:5), each = 2)
```

```{r}
# Use `rep` to construct this vector: 
# 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5
rep(c(1:5), times = 3)
```

## Indexing Vectors

A vector is a list of values that are all the same type.    
Vectors can be created using the `c()` or `rep()` function.     
To create a vector of consecutive values, use the `:` function:

```{r}
a <- 10:15
a
```

Elements of a vector can be extracted using brackets:

```{r}
a[1]
a[5]
```

## Indexing Vectors

Indexes can also be more complicated: 
```{r}
a[c(1, 3, 5)]
a[1:5]
```

## Logical Values

- R has built in support for logical values
- TRUE and FALSE are built in.  T (for TRUE) and F (for FALSE) are supported but can be modified
- Logicals can result from a comparison using
    - $<$
    - $>$
    - $<=$
    - $>=$
    - $==$
    - $!=$
    
## Indexing with Logicals

Logical vectors can be used for indexing as well:

```{r}
x <- c(2, 3, 5, 7)
x[c(TRUE, FALSE, FALSE, TRUE)]
x > 3.5
x[x > 3.5]
```

## Logical Examples

```{r}
# Get the rate variable out of the tips dataset
rate <- tips$rate 

head(rate)

sad_tip <- rate < 0.10

rate[sad_tip]
```

## Data Frames

A collection of vectors, similar to a table in an Excel spreadsheet

- A data set is stored in a data frame
- Each column is a vector of the same length
- Each column can be a different type of data
- Each element in the vector/column has to have the same type of data
- columns can be accessed using `$`


## Data Frames
`tips` is a data frame:
```{r}
head(tips)
```

`tips$sex` shows the `sex` column of `tips`
```{r}
tips$sex[1:20]
# Show the first 20 items in the sex column of tips
```


## Your Turn {data-background=#527a7a}

1. Find out how many people tipped over 20%.    
*Hint: use the `sum` function on a logical vector to calculate how many TRUEs are in the vector:*
```{r}
sum(c(TRUE, TRUE, FALSE, TRUE, FALSE))
```
2. **More Challenging**: Calculate the sum of the total bills of anyone who tipped over 20%

## Solutions {data-background=#527a7a}
#### How many people tipped over 20% 

```{r}
sum(tips$rate > .2)
```

#### Sum of the total bills where the tip was over 20%

```{r}
sum(tips$total_bill[tips$rate > .2])
```

## Modifying Vectors

Vectors can be modified using indexing:

```{r}
bill <- tips$total_bill
x <- bill[1:5]
x
x[1] <- 20
x
```

## Vector Elements

Elements of a vector must all be the same type:

```{r}
head(rate)
rate[sad_tip] <- ":-("
head(rate)
```

By changing a value to a string, all the other values were changed to strings as well.

## Data Types in R

- Can use `mode` or `class` to find out information about variables
- `str` is useful to find information about the structure of your data
- Many data types: numeric, integer, character, Date, and factor most common
    
```{r}
str(tips)
```


## Converting Between Types

Convert variables to a different type using the `as` series of functions:

```{r}
size <- head(tips$size)
size
as.character(size)
as.numeric("2")
```


## Some useful functions

There are a whole variety of useful functions to operate on vectors. 

```{r}
tip <- tips$tip
x <- tip[1:5]
length(x) # Number of elements of a vector
sum(x) # Sum of elements in a vector
```

## Statistical Functions

Using the basic functions it wouldn't be hard to compute some basic statistics.

```{r}
(n <- length(tip))
(meantip <- sum(tip) / n)
(standdev <- sqrt(sum((tip - meantip)^2) / (n - 1)))
```

But these functions are already built in to R.

## Built-in Statistical Functions

```{r}
mean(tip)
sd(tip)
summary(tip)
quantile(tip, c(.025, .975))
```


## Element-wise Logical Operators

- `&` (elementwise AND)
- `|` (elementwise OR)

```{r}
c(T, T, F, F) & c(T, F, T, F)
c(T, T, F, F) | c(T, F, T, F)
# Which are big bills with a poor tip rate?
id <- (bill > 40 & rate < .10)
tips[id,]
```

## Your Turn {data-background=#527a7a}

1. Read up on the dataset (`?diamonds`)
2. Plot price by carat (use qplot - go back to the motivating example for help with the syntax)
3. Create a variable `ppc` for price/carat. Store this variable as a column in the diamonds data
4. Make a histogram of all ppc values that exceed $10000 per carat.
5. Explore any other interesting relationships you find

## Solutions {data-background=#527a7a}
### Plot price by carat 

```{r, fig.height=4, fig.width=7}
qplot(carat, price, data = diamonds)
```

## Solutions {data-background=#527a7a}
### Create a variable `ppc` for price/carat

```{r}
diamonds$ppc <- diamonds$price / diamonds$carat
```

## Solutions {data-background=#527a7a}
### Make a histogram of all ppc values that exceed $10000 per carat.

```{r, fig.height=4, fig.width=7, tidy = F}
qplot(ppc, geom = "histogram",     
      data = diamonds[diamonds$ppc > 10000,])
```
