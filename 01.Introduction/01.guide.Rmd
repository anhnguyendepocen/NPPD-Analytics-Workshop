---
title: "Introduction to R"
output:
  html_document:
    code_folding: show
    fig_caption: yes
    self_contained: yes
    theme: cerulean
    toc: yes
  word_document:
    reference_docx: U:\Templates\Rmarkdown Word\word_template.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = T, error = T)
```

Who has worked with software designed to store, summarize, visualize, or analyze data? 

- Spreadsheets: Microsoft Excel, Google Sheets, etc.
- Data Analysis and Statistical programs: SAS, SPSS, Minitab
- Programming languages: Python, C, C++, Fortran, Java
- Database software: Microsoft Access, SAP, SQL databases

`R` is statistical software which can read data, manipulate data, summarize data, fit statistical models, create quality plots, and more. It is used by companies like Google, Twitter, and Microsoft, as well as in government agencies and at national labs. 

# Setting Up

This guide will help you set up R and RStudio on your machine. It is included for reference. 

## Installing R:

On Windows or OS X:

- Go to http://www.r-project.org/
- Click the CRAN link on the left, and pick a download site (0-Cloud is a good choice)
- Choose link based on your OS
- On Windows, choose the "base" subdirectory to install R.
- On OS X, choose the .pkg file to install R.

## Installing RStudio:

- Browse to https://www.rstudio.com/
- Mouse over Products and click RStudio
- Choose RStudio Desktop
- Click Download RStudio Desktop
- Choose the installer appropriate for your platform

# Example: Tips data

## Goals

- Explore a real dataset using R
- Get the "flavor" of R for data management and exploration
- Don't focus on the code - it will be explained later and in much more detail

## Tips Dataset

A server recorded the tips they received over about 10 weeks, including several variables:

  - Amount they were tipped
  - Cost of the total bill
  - Characteristics about the party (# people, gender, etc.)

Primary Question: How do these variable influence the amount being tipped?

Follow along using [Tips-Example.R](code/Tips-Example.R)

## First look: Reading in the data

Lets use R to look at the top few rows of the tips data set. First, we load tip using `read.csv`:

```{r}
tips <- read.csv("http://srvanderplas.github.com/NPPD-Analytics-Workshop/01.Introduction/data/tips.csv")
```

Now, we use the `head` function to look at the first 6 rows of the data:

```{r}
head(tips)
```

How big is this data set and what types of variables are in each column?

```{r}
str(tips)
```

We can get a summary of the values for each variable in tips:

```{r}
summary(tips)
```


What is the relationship between total bill and tip value?
First, we need to install and load `ggplot2` (a graphics library):

```{r, eval=FALSE}
install.packages("ggplot2")
library(ggplot2)
```

```{r, echo=FALSE, message = F, warning = F}
library(ggplot2)
```

```{r, fig.height = 3, fig.width = 6}
qplot(x = tip, y = total_bill, geom = "point", data = tips)
```

We can add linear regression line to the plot:

```{r, fig.height = 4, fig.width = 6}
qplot(x = tip, y = total_bill, geom = "point", data = tips) + 
    geom_smooth(method = "lm")
```

Tipping is generally done using a rule of thumb based on a percentage of the total bill. We will make a new variable in the data set for the tipping rate = tip / total bill

```{r}
tips$rate <- tips$tip / tips$total_bill

summary(tips$rate)
```

What is the distribution of tip rate in this dataset? We can use R to create a histogram:

```{r, fig.height = 4, fig.width = 6}
qplot(x = rate, data = tips, binwidth = .01)
```

One person tipped over 70%, who are they?

```{r}
tips[which.max(tips$rate),]
```

We can also calculate the average tipping rate for men and women separately:

```{r}
mean(tips$rate[tips$sex == "Male"])
mean(tips$rate[tips$sex == "Female"])
```

Is the difference between the two groups statistically significant? We can calculate a t-test to examine whether the average tip rate for men is the same as the average tip rate for women. 

```{r}
t.test(rate ~ sex, data = tips)
```

The p-value is greater than 0.05, and the confidence interval contains 0: there is no evidence of a significant difference in tipping rate between men and women. 

We can compare two groups using a side-by-side boxplot. For instance, we can see whether smokers tip at a different rate than non-smokers: 

```{r, fig.height = 3, fig.width = 6}
qplot(x = smoker, y = rate, geom = "boxplot", data = tips)
```

## Your Turn!

Try playing with chunks of code shown above to further investigate the tips data:

1. Get a summary of the total bill values
2. Make side by side boxplots of tip rates for different days of the week
3. Find the average tip value for smokers

### Solutions

1. Get a summary of the total bill values
```{r}
summary(tips$total_bill)
```

2. Make side by side boxplots of tip rates for different days of the week
```{r}
qplot(day, rate, geom = "boxplot", data = tips)
```

3. Find the average tip value for smokers
```{r}
mean(tips$tip[tips$smoker == "Yes"])
```

# R Basics

## Getting Help in R
The `help()` function is useful for getting help with a function:

```{r, eval = F}
help(head)
```

The `?` function also works:

```{r, eval = F}
?head
```

When searching for results online, it is helpful to use R + CRAN + <query> to get good results.

## R Reference Card

A copy of the R reference card is available at: 

http://cran.r-project.org/doc/contrib/Short-refcard.pdf

This card contains short versions of the most common functions used in R.

## R as an Overgrown Calculator

R can perform simple mathematical operations.
```{r}
# Addition and Subtraction
2 + 5 - 1

# Multiplication
109*23452

# Division
3/7
```


Here are a few more complex operations:
```{r}
# Integer division
7 %/% 2

# Modulo operator (Remainder)
7 %% 2

# Powers
1.5 ^ 3
```

```{r}
# Exponentiation
exp(3)

# Logarithms
log(3)
log(3, base = 10)

# Trig functions
sin(0)
cos(0)
tan(pi/4)

asin(0)
acos(1)
atan(1)
```

## Variables in R

Variables in R are created using the assignment operator, `<-`:

```{r}
x <- 5
R_awesomeness <- Inf
MyAge <- 21 #Haha
```

These variables can then be used in computation:
```{r}
log(x)
MyAge ^ 2
```

## Rules for Variable Names

- Variable names can't start with a number
- Names are case-sensitive
- Common letters are used internally by R and should be avoided as variable names    
`c, q, t, C, D, F, T, I`
- There are reserved words that R won't let you use for variable names.    
`for, in, while, if, else, repeat, break, next`
- R will let you use the name of a predefined function.    
Try not to overwrite those!

### Error messages:
```{r}
# Variable starts with a number
1age <- 3
```

```{r}
# Case Sensitive
Age <- 3
age
```

```{r}
# Special Words can't be variable names
for <- 3
```

### Cautionary Tale
```{r, eval = T}
# This is a VERY bad idea:

T <- FALSE
F <- TRUE

T == FALSE
F == TRUE

rm(T, F) # Fix it!

T == FALSE
```
Note: In R, `T` and `F` are shorthand for `TRUE` and `FALSE` respectively. 

## Vectors
A variable can contain more than one value.    
A _vector_ is a variable which contains a set of values of the same type.    
The `c()` (combine) function is used to create vectors:

```{r}
y <- c(1, 5, 3, 2)
z <- c(y, y)
```

R performs operations on the entire vector at once:
```{r}
y / 2
z + 3
```


## Your Turn {data-background=#527a7a}

Using the R Reference Card (and the Help pages, if needed), do the following:

1. Find out how many rows and columns the `iris' data set has.  Figure out at least 2 ways to do this.    
*Hint: "Variable Information" section on the first page of the reference card!*
2. Use the `rep` function to construct the following vector:  `1 1 2 2 3 3 4 4 5 5`    
*Hint: "Data Creation" section of the reference card*
3. Use `rep` to construct this vector: `1 2 3 4 5 1 2 3 4 5 1 2 3 4 5`

### Solutions

1. Find out how many rows and columns the `iris' data set has.  Figure out at least 2 ways to do this.

```{r, collapse = T}
data(iris)

# first way: 
nrow(iris)
ncol(iris)

# second way: 
dim(iris)

# third way: 
str(iris) # look at the top line
```

2. Use the `rep` function to construct the following vector:  1 1 2 2 3 3 4 4 5 5
```{r}
rep(c(1:5), each = 2)
```

3. Use `rep` to construct this vector: 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5
```{r}
rep(c(1:5), times = 3)
```

## Indexing Vectors

A vector is a list of values that are all the same type. Vectors can be created using the `c()` or `rep()` function. To create a vector of consecutive values, use the `:` function:

```{r}
a <- 10:15
a
```

Different elements of a vector can be extracted using brackets:

```{r}
a[1]
a[2]
a[5]
```

Indexes can also be more complicated: 
```{r}
a[c(1, 3, 5)]
a[1:5]
```

## Logical Values

- R has built in support for logical values
- TRUE and FALSE are built in.  T (for TRUE) and F (for FALSE) are supported but can be modified
- Logicals can result from a comparison using
    - $<$
    - $>$
    - $<=$
    - $>=$
    - $==$
    - $!=$
    
## Indexing with Logicals

Logical vectors can be used for indexing as well:

```{r}
x <- c(2, 3, 5, 7)
x[c(TRUE, FALSE, FALSE, TRUE)]
x > 3.5
x[x > 3.5]
```

### Logical Examples

```{r}
# Get the rate variable out of the tips dataset
rate <- tips$rate 

head(rate)

sad_tip <- rate < 0.10

rate[sad_tip]
```

## Data Frames

A collection of vectors, similar to a table in an Excel spreadsheet

- A data set is stored in a data frame
- Each column is a vector of the same length
- Each column can be a different type of data
- Each element in the vector/column has to have the same type of data
- columns can be accessed using `$`


`tips` is a data frame:
```{r}
head(tips)
```

`tips$sex` shows the `sex` column of `tips`
```{r}
tips$sex[1:20]
# Show the first 20 items in the sex column of tips
```


## Your Turn {data-background=#527a7a}

1. Find out how many people tipped over 20%.    
*Hint: use the `sum` function on a logical vector to calculate how many TRUEs are in the vector:*
```{r}
sum(c(TRUE, TRUE, FALSE, TRUE, FALSE))
```
2. **More Challenging**: Calculate the sum of the total bills of anyone who tipped over 20%
